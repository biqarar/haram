$(document).ready(function(){$.ajaxSetup({cache:false});function a(){var d=$(window).height()+150;var c=d-parseInt($(".menu").css("height"));c=c/2;$(".menu").css("top",c);$("#tabs>div").css("min-height",($(window).height()-225)+"px")}a();$(window).resize(function(){a()}).scroll(function(){a()});$(".menu>div").each(function(){$(this).mouseover(function(){$(this).children(".dropdown").stop().fadeIn(200)}).mouseout(function(){$(this).children(".dropdown").stop().fadeOut(200)})});$("#tabs a").each(function(){if(/^#/.test($(this).attr("href"))){var c=location.pathname+$(this).attr("href");$(this).attr("href",c)}});var b=$("#tabs").tabs({beforeActivate:function(g,f){var d=f.newTab.attr("aria-controls");activeState=(location.hash).replace(/\#/,"");if(f.newTab.find("a").attr("href")=="/portal/#tab-1"){sls_pushState(null,f.newTab.find("a").text(),"#"+d)}else{if(activeState!=d){var c=f.newTab.find("a").attr("href");c=c.replace(/^\.?\/?/,"");c=c.replace(/\/$/,"");sls_pushState(null,f.newTab.find("a").text(),c+"#"+d)}}},beforeLoad:function(d,c){a();if(c.tab.is(".loadContentAjax")){return false}c.panel.html('<embed src="static/svg/logo-animation.svg" class="perload-svg" height="150" type="image/svg+xml" />');c.panel.html=function(h){c.tab.addClass("loadContentAjax");var g=$("<span>"+h+"</span>").find("#global");g=g.text();try{g=$.parseJSON(g);c.tab.find("a").html(g.page_title);$("title").text(g.page_title);setTabLI(c.tab)}catch(i){g=false}var f=$("<span>"+h+"</span>").find("#content");$(this).html(f);readyState($(this));a()}},activate:function(d,c){$("title").text(c.newTab.find("a").text())}});b.find(".ui-tabs-nav li").each(function(){setTabLI($(this))});b.find(".ui-tabs-nav").sortable({distance:30,tolerance:"pointer",opacity:0.7,sort:function(c,d){},placeholder:"x4",start:function(d,c){if(c.item.is(".ui-tabs-active")){$(".x4").addClass("active")}},stop:function(d,c){c.item.css("z-index","");c.item.css("opacity",0);c.item.fadeTo("fast",1);b.tabs("refresh")}});b.delegate("span.ui-icon-close","click",function(){var c=$(this).closest("li").fadeOut("fast",function(){$(this).remove()}).attr("aria-controls");$("#"+c).fadeOut("fast",function(){$(this).remove();b.tabs("refresh")})});$("#tabs>ul").droppable({accept:"a",drop:function(d,e){$(".deactive-tab").remove();var c=e.draggable.attr("href");var f=e.draggable.text();addTab(c,f)},over:function(c,d){addTab("#",d.helper.text(),true)},out:function(){$(".deactive-tab").remove()}})});function addTab(a,d,b){var c=$("<li><a href='"+a+"'>"+d+"</a></li>");$("#tabs").find(".ui-tabs-nav").append(c);if(b){c.addClass("deactive-tab").addClass("ui-state-default")}if(!b){$("#tabs").tabs("refresh")}setTabLI(c)}function setTabLI(c){var b=c.find("a");if(b.outerWidth()!==b[0].scrollWidth){c.addClass("dot3")}else{c.removeClass("dot3")}c.append('<span class="ui-icon ui-icon-close" role="presentation"></span>');var d=c.text();d=d.replace(/^\s*/,"");d=d.replace(/\s*$/,"");c.attr("title",d)}(function(){var e=false;var d=new Array();var c=new Array();function a(g,h){var h=(typeof h==="object")?h:new Object();if(e){g.call()}else{d.push(g)}if(h.onState){c.push(g.bind(true))}}function b(g){c.forEach(function(f){f(g)})}window.addEventListener("load",function(){e=true;d.forEach(function(f){f()});d=new Array()});ready=a;readyState=b})();function aClickTabs(f){var a,h,d;var b=$(this).attr("href");var g=$(this).text();if($(this).attr("target")=="_blank"){h=true}if(f.button||h){addTab(b,g);a=$("#tabs .ui-tabs-nav > li").size()-1;d=$("#tabs>ul>li").eq(a).attr("aria-controls")}else{a=$("#tabs").tabs("option","active");var c=$("#tabs>ul>li").eq(a).removeClass("loadContentAjax");d=$("#tabs>ul>li").eq(a).attr("aria-controls");c.find("a").attr("href",b)}if(f.button||h){$("#tabs").tabs({active:a})}else{$("#tabs").tabs("load",a);sls_pushState(null,g,b+"#"+d)}return false}(function(a){a.fn.persian_nu=function(b){a(this).each(function(){var c=Array("۰","۱","۲","۳","۴","۵","۶","۷","۸","۹");var d=Array("0","1","2","3","4","5","6","7","8","9");for(n in a(this)[0].childNodes){if(!a(this).is(".notp")){if(a(this)[0].childNodes[n].nodeName=="#text"){var e=a(this)[0].childNodes[n].textContent;if(b){var f=e.replace(/[۱۲۳۴۵۶۷۸۹۰]/gi,function(){return c.indexOf(arguments[0])})}else{var f=e.replace(/\d/gi,function(){return c[d.indexOf(arguments[0])]})}a(this)[0].childNodes[n].textContent=f}}}})}})(jQuery);$(function(){var e=".filebox-form";var a=".filebox";var d=".filebox-close";var c=null;var b=null;$.fn.filebox=function(){b=$(this);c=$(this).next(c);c.ajxCall(function(f){$(this).find("[name=base]").val(f.msg.base);$(this).fileboxClose(f)});c.find(d).click(function(){$(this).parents("form").fileboxClose()});b.find(a).fileboxShow()};$.fn.fileboxClose=function(g){var f=$(this).prev("form");if(g){b.onFiles(g)}$(this).hide();f.fadeIn("fast")};$.fn.fileboxShow=function(){$(this).click(function(){var f=$(this).parents("form").next("form");$(this).parents("form").hide();f.fadeIn("fast",function(){$(this).find("input[type='text']")[0].focus()})})};$.fn.onFiles=function(g){if(typeof g==="function"){$(this).data("onFiles",g)}else{if($(this).data("onFiles")){var h=$(this).data("onFiles");h.call(this,g)}}}});function imageChangeSize(a){console.log(a);$(this).find(".img-crop").val(a.x+" "+a.y+" "+a.w+" "+a.h)}ready(function(b){b=b?b:$("body");b.find("a").not(".ui-tabs-anchor, .a-undefault").draggable({helper:"clone",snap:"#tabs>ul",distance:20}).click(aClickTabs);b.find(".ajx").filebox();b.find(".posts-form-options").onFiles(function(e){var g=e.msg.publicAddr?e.msg.publicAddr:e.msg.fileAddr+"."+e.msg.type;console.log(g);$(this).find(".img-preview").attr("src",g);var d=this;$(this).find("#postImg").val(e.msg.id);if($(this).find(".img-preview").data("Jcrop")){var f=$(this).find(".img-preview").data("Jcrop");f.destroy()}$(this).find(".img-preview").Jcrop({onChange:function(h){imageChangeSize.call(d,h)},onSelect:function(h){imageChangeSize.call(d,h)},aspectRatio:1,setSelect:[0,0,100,100],bgColor:"#00bbec"},function(){$(d).data("Jcrop",this)})});b.find("#tabs, #tabs li a.ui-tabs-anchor").scroll(function(d){this.scrollLeft=9000});b.find("input[date=date]").each(function(){var d=this;$(this).persianDatepicker({formatDate:"YYYY-MM-DD",isRTL:false,onSelect:function(){if(d.callBackDate){var e=d.callBackDate;e.call(d)}}})});b.find("input[time=time]").clockpicker();b.find("*:not(style)").persian_nu();b.find("select:not([name=data_table_length])").selectmenu();b.find(".select-province").on("selectmenuchange",function(e,f){var d=$(this).parents("form").find(".select-city");d.attr("disabled","disabled");d.children(":not(*[disabled='disabled'])").remove();var g="city/api/"+f.item.value;$.ajax({type:"POST",context:d,url:g,success:function(j){if(typeof j==="object"){for(var h=0;h<j.msg.city.length;h++){var k=j.msg.city[h];$("<option value='"+k.id+"'>"+k.name+"</option>").appendTo($(this))}}d.removeAttr("disabled");d.selectmenu("refresh")}})});b.find(".select-education-group").on("selectmenuchange",function(e,f){var d=$(this).parents("form").find(".select-education-section");d.attr("disabled","disabled");d.children(":not(*[disabled='disabled'])").remove();$.ajax({context:d,url:"education/api/"+f.item.value,success:function(j){if(typeof j==="object"){for(var g=0;g<j.msg.education.length;g++){var h=j.msg.education[g];$("<option value='"+h.id+"'>"+h.section+"</option>").appendTo($(this))}}d.removeAttr("disabled");d.selectmenu("refresh")}})});$("input[name='pasport_date'],label[for='pasport_date']").hide();b.find(".select-nationality").on("selectmenuchange",function(d,e){if(e.item.value!=97){$(this).parents("form").find(".select-province").attr("disabled","disabled").selectmenu("refresh");$(this).parents("form").find(".select-city").attr("disabled","disabled").selectmenu("refresh");$(this).parents("form").find("input[name='pasport_date'],label[for='pasport_date']").fadeIn(200)}else{$(this).parents("form").find(".select-province").removeAttr("disabled").selectmenu("refresh");$(this).parents("form").find(".select-city").removeAttr("disabled").selectmenu("refresh");$(this).parents("form").find("input[name='pasport_date'],label[for='pasport_date']").fadeOut(200)}});function a(){if(b.find(".marriage-form:checked").val()=="single"){b.find(".children-form").attr("disabled","disabled")}else{b.find(".children-form").removeAttr("disabled")}}a();b.find(".marriage-form").change(a);var c=((Math.random()).toString()).replace(/^\d\./,"");b.find("#data_table").on("draw.dt",function(){$(".dataTables_info").persian_nu();$(".dataTables_paginate a").persian_nu()}).dataTable({processing:true,serverSide:true,ajax:"users/status=api/session="+c,language:{processing:"درحال بارگذاری",search:"جستجو:",lengthMenu:"مقدار _MENU_ سطر",info:"مقدار _START_ تا _END_ از _TOTAL_ سطر",infoEmpty:"هیچ سطری یافت نشد",infoFiltered:"(مقدار _MAX_ بدون فیلتر)",infoPostFix:"",loadingRecords:"درحال بارگذاری...",zeroRecords:"هیچ سطری یافت نشد",emptyTable:"هیچ سطری یافت نشد",paginate:{first:"نخست",previous:"قبلی",next:"بعدی",last:"آخرین"},aria:{sortAscending:": مرتب سازی صعودی",sortDescending:": مرتب سازی نزولی"}},columns:[{data:"name"},{data:"family"},{data:"father"},{data:"birthday"},{data:"gender"},{data:"nationalcode"},{data:"code"},{data:"marriage"},{data:"education_id"},{data:"id"},{data:"id"}],order:[[9,"asc"]],lengthMenu:[[10,25,50],[10,25,50]],createdRow:function(i,h,e){var d;var f=$("td",i).eq(9);f.persian_nu(true);d=f.text();f.html('<a class="icomore ui-draggable ui-draggable-handle" href="users/status=detail/id='+d+'"></a>');$("td",i).persian_nu();var g=$("td",i).eq(10);g.persian_nu(true);d=g.text();g.html('<a class="icoedit ui-draggable ui-draggable-handle" href="person/status=edit/id='+d+'"></a>');readyState($(i))}})},{onState:true});ready(function(){$("#perload-blockoff").remove()});function sls_pushState(b,c,a){history.pushState(b,c,a)}window.onpopstate=function(d){var e=$("#tabs").tabs("option","active");var a;var b=(location.hash).replace(/\#/,"");if(b){var c=$("[aria-controls="+b+"]");if(c.length>0){a=c.index()}else{a=0}}else{a=0}$("#tabs").tabs({active:a});if(a==e){href=location.href;href=href.replace(/\#(.*)$/,"");$("#tabs>ul>li").eq(a).find("a").attr("href",href);var c=$("#tabs>ul>li").eq(a).removeClass("loadContentAjax");$("#tabs").tabs("load",a)}};(function(a){a.fn.ajx=function(h){var c=new Object();c.elements=this;function g(){c.elements.each(function(){if(a(this).is("a")){a(this).unbind("click.state");a(this).unbind("click.ajx");a(this).bind("click.ajx",function(){try{f({base:this,url:a(this).attr("href")})}catch(i){console.log(i.stack)}return false})}else{if(a(this).is("form")){a(this).unbind("click.ajx");a(this).bind("submit.ajx",function(){try{e({base:this,url:a(this).attr("action"),data:b.call(this)})}catch(i){console.log(i.stack)}return false})}}})}function b(){var i=new FormData();a(this).find("select, input, button, textarea").each(function(){var m=false;var k=this.name;if(a(this).is(":file")){var j=a(this)[0].files;if(a(this).attr("multiple")){for(var l=0;l<j.length;l++){i.append(k+"[]",j[l])}}else{i.append(k,j[0])}}else{if(a(this).is(":radio, :checkbox")){if(a(this).is(":checked")){m=this.value}else{m=false}}else{m=this.value}}if(m!==false){i.append(k,m)}});return i}function f(j){if(h.before){h.before(j.base,"nav")}a.get(j.url,function(k){if(h.after){h.after(arguments[2],j.base,"nav")}var k;try{k=a.parseJSON(k);if(k.status===1){h.success(k);d(k,j.base)}else{i(arguments[2])}}catch(l){i(arguments[2])}}).error(i);function i(k){if(h.after){h.after(k,j.base,"nav")}if(h.error){h.error(k,j.base,"nav")}}}function e(m){if(h.before){h.before(m.base,"form")}var k=a('<span class="uploadPerload"></span>');var i=a(m.base).find(":submit:eq(0)");i.addClass("btn-default");i.css({position:"relative",overflow:"hidden"});k.appendTo(i);var j=a.ajax({type:"POST",processData:false,contentType:false,xhr:function(){var o=a.ajaxSettings.xhr();if(o){o.upload.addEventListener("progress",function(r){var q=r.totalSize/(1024*1024);var p=r.position/(1024*1024);p=((p*100)/q);k.css("width",p+"%");a(".progress-bar").css("width",p+"%");if(p==100){k.addClass("stateUPerlaod");k.removeClass("uploadPerload")}},false)}return o},url:m.url,data:m.data,}).complete(function(o){if(h.after){h.after(o,m.base,"form")}if(o.status==200){try{var p=a.parseJSON(o.responseText);if(p.status===1){if(h.success){h.success(p,m.base);d(p,m.base)}}else{l(o,m.base)}}catch(q){l(o,m.base)}}}).error(function(o){l(o,m.base)});function l(o){if(h.error){h.error(o,m.base,"form")}}}function d(j,i){if(a(i).data("ajxCallBack")){a(i).data("ajxCallBack").call(i,j)}}g();return c};a.fn.ajxCall=function(b){if(typeof b==="function"){a(this).data("ajxCallBack",b)}}})(jQuery);var O={before:function(c,a){if(a=="form"){$(c).find("select, input, button, textarea").attr("disabled","disabled")}else{if(a=="nav"){var b=$("<span class='statePerlaod'></span>").appendTo($(c))}}},after:function(a,f,b){if(b=="form"){$(f).find(".stateUPerlaod").remove();$(f).find(".uploadPerload").remove();$(f).find("select, input, button, textarea").removeAttr("disabled")}else{if(b=="nav"){$(f).children(".statePerlaod").remove()}}var d=a.responseText;try{d=$.parseJSON(d)}catch(g){}if(d.msg&&d.msg.captcha){var h=$(f).find("img[src='captcha.png']");h.attr("src","captcha.png?cid"+(Math.random()))}},success:function(d,c){var f=$(c).parents(".ui-tabs-panel");$(c)[0].reset();f.find(".submit-status").remove();var b=$('<div class="submit-status"></div>');b.insertAfter($(c));var e,a;for(e in d){if(/^(true|warn)$/i.test(e)){a=$('<ul class="submit-status-'+e+'"></ul>');a.appendTo(b);for(cStatus in d[e]){if(!(/^\d+$/.test(cStatus))){continue}if(typeof d[e][cStatus]=="object"){$("<li>"+d[e][cStatus]["error"]+"</li>").appendTo(a)}else{console.log(d[e],cStatus);$("<li>"+d[e][cStatus]+"</li>").appendTo(a)}}}}},error:function(j,d,i){if(j.status==0){return}var g;try{g=$.parseJSON(j.responseText)}catch(h){g=j.responseText;console.error(g)}var c=$(d).parents(".ui-tabs-panel");c.find(".submit-status").remove();var f=$('<div class="submit-status"></div>');f.insertAfter($(d));var a,b;for(a in g){if(/^(fatal)$/i.test(a)){b=$('<ul class="submit-status-'+a+'"></ul>');b.appendTo(f);for(cStatus in g[a]){if(!(/^\d+$/.test(cStatus))){continue}if(typeof g[a][cStatus]=="object"){$("<li>"+g[a][cStatus]["error"]+"</li>").appendTo(b)}else{$("<li>"+g[a][cStatus]+"</li>").appendTo(b)}}}}}};ready(function(a){if(a){a.find(".ajx").ajx(O)}else{$(".ajx").ajx(O)}},{onState:true});
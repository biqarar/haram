/** In the name Of Allah
 * Banoo 
 * @author ahmad karimi, reza mohiti, baravak
 * @version 0.1.0 2014-12-10
 */
!function(a){a.fn.ajx=function(b){function c(){h.elements.each(function(){a(this).is("a")?(a(this).unbind("click.state"),a(this).unbind("click.ajx"),a(this).bind("click.ajx",function(){try{e({base:this,url:a(this).attr("href")})}catch(b){console.log(b.stack)}return!1})):a(this).is("form")&&(a(this).unbind("click.ajx"),a(this).bind("submit.ajx",function(){try{f({base:this,url:a(this).attr("action"),data:d.call(this)})}catch(b){console.log(b.stack)}return!1}))})}function d(){var b=new FormData;return a(this).find("select, input, button, textarea").each(function(){var c=!1,d=this.name;if(a(this).is(":file")){var e=a(this)[0].files;if(a(this).attr("multiple"))for(var f=0;f<e.length;f++)b.append(d+"[]",e[f]);else b.append(d,e[0])}else c=a(this).is(":radio, :checkbox")?a(this).is(":checked")?this.value:!1:this.value;c!==!1&&b.append(d,c)}),b}function e(c){function d(a){b.after&&b.after(a,c.base,"nav"),b.error&&b.error(a,c.base,"nav")}b.before&&b.before(c.base,"nav"),a.get(c.url,function(e){b.after&&b.after(arguments[2],c.base,"nav");var e;try{e=a.parseJSON(e),1===e.status?(b.success(e),g(e,c.base)):d(arguments[2])}catch(f){d(arguments[2])}}).error(d)}function f(c){function d(a){b.error&&b.error(a,c.base,"form")}b.before&&b.before(c.base,"form");var e=a('<span class="uploadPerload"></span>'),f=a(c.base).find(":submit:eq(0)");f.addClass("btn-default"),f.css({position:"relative",overflow:"hidden"}),e.appendTo(f);a.ajax({type:"POST",processData:!1,contentType:!1,xhr:function(){var b=a.ajaxSettings.xhr();return b&&b.upload.addEventListener("progress",function(b){var c=b.totalSize/1048576,d=b.position/1048576;d=100*d/c,e.css("width",d+"%"),a(".progress-bar").css("width",d+"%"),100==d&&(e.addClass("stateUPerlaod"),e.removeClass("uploadPerload"))},!1),b},url:c.url,data:c.data}).complete(function(e){if(b.after&&b.after(e,c.base,"form"),200==e.status)try{var f=a.parseJSON(e.responseText);1===f.status?b.success&&(b.success(f,c.base),g(f,c.base)):d(e,c.base)}catch(h){d(e,c.base)}}).error(function(a){d(a,c.base)})}function g(b,c){a(c).data("ajxCallBack")&&a(c).data("ajxCallBack").call(c,b)}var h=new Object;return h.elements=this,c(),h},a.fn.ajxCall=function(b){"function"==typeof b&&a(this).data("ajxCallBack",b)}}(jQuery);var O={before:function(a,b){if("form"==b)$(a).find("select, input, button, textarea").attr("disabled","disabled");else if("nav"==b){$("<span class='statePerlaod'></span>").appendTo($(a))}},after:function(a,b,c){"form"==c?($(b).find(".stateUPerlaod").remove(),$(b).find(".uploadPerload").remove(),$(b).find("select, input, button, textarea").removeAttr("disabled")):"nav"==c&&$(b).children(".statePerlaod").remove();var d=a.responseText;try{d=$.parseJSON(d)}catch(e){}if(d.msg&&d.msg.captcha){var f=$(b).find("img[src='captcha.png']");f.attr("src","captcha.png?cid"+Math.random())}},success:function(a,b){var c=$(b).parents(".ui-tabs-panel");$(b)[0].reset(),c.find(".submit-status").remove();var d=$('<div class="submit-status"></div>');d.insertAfter($(b));var e,f;for(e in a)if(/^(true|warn)$/i.test(e)){f=$('<ul class="submit-status-'+e+'"></ul>'),f.appendTo(d);for(cStatus in a[e])/^\d+$/.test(cStatus)&&("object"==typeof a[e][cStatus]?$("<li>"+a[e][cStatus].error+"</li>").appendTo(f):(console.log(a[e],cStatus),$("<li>"+a[e][cStatus]+"</li>").appendTo(f)))}},error:function(a,b){if(0!=a.status){var c;try{c=$.parseJSON(a.responseText)}catch(d){c=a.responseText,console.error(c)}var e=$(b).parents(".ui-tabs-panel");e.find(".submit-status").remove();var f=$('<div class="submit-status"></div>');f.insertAfter($(b));var g,h;for(g in c)if(/^(fatal)$/i.test(g)){h=$('<ul class="submit-status-'+g+'"></ul>'),h.appendTo(f);for(cStatus in c[g])/^\d+$/.test(cStatus)&&("object"==typeof c[g][cStatus]?$("<li>"+c[g][cStatus].error+"</li>").appendTo(h):$("<li>"+c[g][cStatus]+"</li>").appendTo(h))}}}};ready(function(a){a?a.find(".ajx").ajx(O):$(".ajx").ajx(O)},{onState:!0});